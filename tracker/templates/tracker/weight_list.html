{% extends 'tracker/base.html' %}
{% block title %}Weight - Fitrack{% endblock %}

{% block content %}
<style>
  body {
    background: linear-gradient(135deg, #0b132b, #1c2541);
    color: #e0e0e0;
    font-family: 'Poppins', sans-serif;
  }

  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }

  .page-header h2 {
    color: #00ffc8;
    font-weight: 600;
    font-size: 1.6rem;
  }

  .btn-add {
    background: linear-gradient(90deg, #00ffc8, #00b4ff);
    color: #000;
    font-weight: 600;
    padding: 0.6rem 1.2rem;
    border-radius: 0.8rem;
    text-decoration: none;
    border: none;
    transition: all 0.3s ease;
  }

  .btn-add:hover {
    background: linear-gradient(90deg, #00b4ff, #00ffc8);
    transform: scale(1.05);
    box-shadow: 0 0 12px rgba(0, 255, 200, 0.4);
  }

  .card {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 1rem;
    padding: 1.5rem;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.35);
    transition: transform 0.3s ease;
  }

  .card:hover {
    transform: translateY(-3px);
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }

  thead {
    color: #00ffc8;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  th, td {
    padding: 0.8rem;
    text-align: left;
  }

  tbody tr {
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    transition: background 0.2s ease;
  }

  tbody tr:hover {
    background: rgba(0, 255, 200, 0.05);
  }

  a.text-blue-600 {
    color: #00b4ff;
    transition: color 0.2s ease;
  }

  a.text-blue-600:hover {
    color: #00ffc8;
  }

  a.text-red-600 {
    color: #ff5757;
    transition: color 0.2s ease;
  }

  a.text-red-600:hover {
    color: #ff9494;
  }

  canvas {
    width: 100%;
    max-height: 300px;
    border-radius: 0.8rem;
    background: rgba(255, 255, 255, 0.02);
  }

  @media (max-width: 640px) {
    .page-header {
      flex-direction: column;
      gap: 1rem;
      text-align: center;
    }

    table {
      font-size: 0.9rem;
    }
  }
</style>

<div class="page-header">
  <h2>Weight Progress Tracker</h2>
  <a href="{% url 'tracker:weight_add' %}" class="btn-add">Add Weight</a>
</div>

<div class="card">
  <canvas id="weightChart" height="120"></canvas>
</div>

<div class="mt-4 card table-wrap">
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Weight</th>
        <th>Notes</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      {% for w in weights %}
      <tr>
        <td>{{ w.date }}</td>
        <td>{{ w.weight }} kg</td>
        <td>{{ w.notes|default:"-" }}</td>
        <td class="small">
          <a href="{% url 'tracker:weight_edit' w.pk %}" class="text-blue-600 small">Edit</a> |
          <a href="{% url 'tracker:weight_delete' w.pk %}" class="text-red-600 small">Delete</a>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="4" class="py-4 muted">No weight entries yet.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
{% block extra_js %}
{{ block.super }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  (function(){
    const labels = {{ chart_labels|safe }} || [];
    const data = {{ chart_data|safe }} || [];

    if (!labels.length || !data.length) {
      console.warn("No chart data to display.");
      return;
    }

    const ctx = document.getElementById('weightChart').getContext('2d');
    const gradient = ctx.createLinearGradient(0, 0, 0, 250);
    gradient.addColorStop(0, 'rgba(0, 255, 200, 0.4)');
    gradient.addColorStop(1, 'rgba(0, 255, 200, 0.05)');

    if (window.weightChart) {
      window.weightChart.destroy();
    }

    window.weightChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Weight (kg)',
          data: data,
          fill: true,
          backgroundColor: gradient,
          borderColor: '#00ffc8',
          borderWidth: 2.5,
          tension: 0.35,
          pointBackgroundColor: '#00b4ff',
          pointRadius: 4,
          pointHoverRadius: 7,
          pointHoverBackgroundColor: '#00ffc8',
          pointHoverBorderColor: '#fff'
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          tooltip: {
            backgroundColor: 'rgba(0,0,0,0.7)',
            titleColor: '#00ffc8',
            bodyColor: '#fff',
            borderWidth: 1,
            borderColor: '#00ffc8',
            padding: 10,
            displayColors: false
          }
        },
        scales: {
          x: {
            ticks: { color: '#e0e0e0' },
            grid: { color: 'rgba(255,255,255,0.05)' }
          },
          y: {
            ticks: { color: '#e0e0e0' },
            grid: { color: 'rgba(255,255,255,0.05)' },
            beginAtZero: false
          }
        },
        animation: {
          duration: 1200,
          easing: 'easeInOutQuart'
        }
      }
    });
  })();
</script>
{% endblock %}
